<!DOCTYPE html>
<html>
<head>
    <title>Kafka Admin UI Console</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/dynatable-docs-assets/css/reset.css" />
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/dynatable-docs-assets/css/bootstrap-2.3.2.min.css" />
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/dynatable-docs-assets/css/application.css" />
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/dynatable-docs-assets/css/project.css" />
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/dynatable-docs-assets/css/pygments.css" />
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/dynatable-docs-assets/css/share.css" />
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/dynatable-docs-assets/css/dynatable-docs.css" />
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/dynatable-docs-assets/css/jquery.dynatable.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="css/dialog-ui.css">
    <link rel="stylesheet" href="css/main.css">

    <script type='text/javascript' src='https://s3.amazonaws.com/dynatable-docs-assets/js/jquery-1.9.1.min.js'></script>
    <script type='text/javascript' src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type='text/javascript' src='https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.scrollTo.js'></script>
    <script type='text/javascript' src='https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.toc.min.js'></script>
    <script type='text/javascript' src='https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.sharrre-1.2.0.min.js'></script>
    <script type='text/javascript' src='https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.dynatable.js'></script>
</head>

<body>
  <header>
    <button class="hamburger">&#9776;</button>
    <button class="cross">&#735;</button>
  </header>
  <div class="menu">
  <ul>
    <a href="#"><li>Cluster</li></a>
  </ul>
  <ul>
    <a href="#"><li>Broker</li></a>
  </ul>
  <ul>
    <a href="#"><li>Topic</li></a>
  </ul>
</div>

<article>

<div id="dialog-delete-topic" title="Delete Topic">
  <p id="delete-topic-def">Are you sure you want to delete the topic: <span id="delete-topic-name"></span></p>
</div>

<div id="dialog-delete-cgroup" title="Delete Consumer Group">
  <p id="delete-cgroup-def">Are you sure you want to delete the consumer group: <span id="delete-cgroup-name"></span></p>
</div>

<div id="dialog-new-topic" title="Create new Topics">
 <p id="new-topic-def">
   <form>
     <table id="new-topic-form">
       <tbody>
       <tr>
         <td>
           Name
         </td>
         <td>
           <input id="new-topic-form-name" type="text" name="name">
         </td>
       </tr>
       <tr>
         <td>
           Partition Number
         </td>
         <td>
           <input id="new-topic-form-partition" type="number" name="partition">
         </td>
       </tr>
       <tr>
         <td>
           Replication Factor
         </td>
         <td>
           <input id="new-topic-form-replication" type="number" name="repfactor">
         </td>
       </tr>
     </tbody>
     </table>
   </form>
 </p>
</div>

<h1>Controller</h1>
<div class="row-fluid">
<a id="cdivtrigger" href="#">show/hide</a>
<div id="cdiv" class="span6">
<table class="table table-bordered" id="controller-table">
  <thead>
    <th>Id</th>
    <th>Host</th>
    <th>Port</th>
    <th>Has Rack?</th>
    <th>Rack</th>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>

<hr/>

<h1>Brokers</h1>
<div class="row-fluid">
<a id="bdivtrigger" href="#">show/hide</a>
<div id="bdiv" class="span6">
<table class="table table-bordered" id="brokers-table">
  <thead>
    <th>Id</th>
    <th>Host</th>
    <th>Port</th>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>

<hr/>

<h1>Topics</h1>
<div class="row-fluid">
<a id="tdivtrigger" href="#">show/hide</a>
<div id="tdiv" class="span6">
<div class="span6">
<table class="table table-bordered" id="topics-table">
  <thead>
    <th>Name</th>
    <th>Operations</th>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>
</div>
 <a id="new-topic" href="#">Create new topics</a>
<hr/>

<h1>Consumer Groups</h1>
<div class="row-fluid">
<a id="cgdivtrigger" href="#">show/hide</a>
<div id="cgdiv" class="span6">
<div class="span6">
<table class="table table-bordered" id="cgroups-table">
  <thead>
    <th>Group Id</th>
    <th>Simple?</th>
    <th>Operations</th>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>

</article>

<script>

var handle200 = function(data, textStatus, jqXHR) {
    alert('200');
}

var handleTopicCreated = function(data, textStatus, jqXHR) {
    alert('Element created!');
    $("#topics-table tbody").html("");
    $.ajax({
      url: 'http://localhost:8080/api/topics',
      success: function(data){
        var row = "";
          $.each(data, function (index, value) {
            //console.log(value);
            row += "<tr><td>" + value.name + "</td><td><a href='#' onclick='deleteTopic(\"" + value.name + "\");'>delete</a></td></tr>";});

          $("#topics-table tbody").append(row);

      }
    });
}

var handleTopicDeleted = function(data, textStatus, jqXHR) {
    alert('Element deleted!');
    $("#topics-table tbody").html("");
    $.ajax({
      url: 'http://localhost:8080/api/topics',
      success: function(data){
        var row = "";
          $.each(data, function (index, value) {
            //console.log(value);
            row += "<tr><td>" + value.name + "</td><td><a href='#' onclick='deleteTopic(\"" + value.name + "\");'>delete</a></td></tr>";});

          $("#topics-table tbody").append(row);

      }
    });
}

var handleCgroupDeleted = function(data, textStatus, jqXHR) {
    alert('Element deleted!');
    $("#cgroups-table tbody").html("");
    $.ajax({
      url: 'http://localhost:8080/api/consumergroups',
      success: function(data){
        var row = "";
        $.each(data, function (index, value) {
          //console.log(value);
          row += "<tr><td>" + value.groupId + "</td><td>" + value.simpleConsumerGroup + "</td><td><a href='#' onclick='deleteCgroup(\"" + value.groupId + "\");'>delete</a></td></tr>";});

        $("#cgroups-table tbody").append(row);

      }
    });
}

var handle404 = function(jqXHR, textStatus, errorThrown) {
    alert('Page not found');
}

var handle500 = function(jqXHR, textStatus, errorThrown) {
    alert('Error:' + textStatus);
}

//div toggle
$('#cdiv').hide();
$('#bdiv').hide();
$('#tdiv').hide();
$('#cgdiv').hide();
$('a#cdivtrigger').click(function () {
  $('#cdiv').toggle(400);
});
$('a#bdivtrigger').click(function () {
  $('#bdiv').toggle(400);
});
$('a#tdivtrigger').click(function () {
  $('#tdiv').toggle(400);
});
$('a#cgdivtrigger').click(function () {
  $('#cgdiv').toggle(400);
});

//hamburger menu
$(".hamburger").click(function() {
  $(this).hide();
  $('.cross').show();
  $(".menu").slideToggle();
});
$(".cross").click(function() {
  $(this).hide();
  $('.hamburger').show();
  $(".menu").slideToggle();
});

$('#dialog-delete-topic').dialog({
      modal: true,
      autoOpen: false,
      closeOnEscape: false,
      open: function(event, ui) {
        $(".ui-dialog-titlebar-close", ui.dialog || ui).hide();
      },
      width: 350,
      height: 250,
      open: function() {
            jQuery('.ui-widget-overlay').on('click', function() {
                jQuery('#dialog-delete-topic').dialog('close');
            })
      },
      buttons: {
        Ok: function() {
          var topicName = $('#delete-topic-name').html();

          $.ajax({
            type: "DELETE",
            url: 'http://localhost:8080/api/topics',
            data: '{"topics": "' + topicName + '"}',
            dataType: "json",
            statusCode: {
              200: handle200,
              202: handleTopicDeleted,
              404: handle404,
              500: handle500
            }
          });

          $( this ).dialog( "close" );
        },
        Cancel: function() {
          $( this ).dialog( "close" );
        }
      },
      show: {
        effect: "bounce",
        duration: 1000
      },
      hide: {
        effect: "fade",
        duration: 1000
      }
});


$('#dialog-new-topic').dialog({
      modal: true,
      autoOpen: false,
      closeOnEscape: false,
      open: function(event, ui) {
        $(".ui-dialog-titlebar-close", ui.dialog || ui).hide();
      },
      width: 350,
      height: 250,
      open: function() {
            jQuery('.ui-widget-overlay').on('click', function() {
                jQuery('#dialog-new-topic').dialog('close');
            })
      },
      buttons: {
        Ok: function() {
          var topicName = $('#new-topic-form-name').val();
          var topicPartition = $('#new-topic-form-partition').val();
          var topicRep = $('#new-topic-form-replication').val();

          $.ajax({
            type: "PUT",
            url: 'http://localhost:8080/api/topics',
            data: '{"topics": [{"name":"' + topicName + '","numPartitions": ' + topicPartition + ',"replicationFactor": ' + topicRep + '}]}',
            dataType: "json",
            statusCode: {
              200: handle200,
              201: handleTopicCreated,
              404: handle404,
              500: handle500
            }
          });

          $( this ).dialog( "close" );
        },
        Cancel: function() {
          $( this ).dialog( "close" );
        }
      },
      show: {
        effect: "bounce",
        duration: 1000
      },
      hide: {
        effect: "fade",
        duration: 1000
      }
});

$('#dialog-delete-cgroup').dialog({
      modal: true,
      autoOpen: false,
      closeOnEscape: false,
      open: function(event, ui) {
        $(".ui-dialog-titlebar-close", ui.dialog || ui).hide();
      },
      width: 350,
      height: 250,
      open: function() {
            jQuery('.ui-widget-overlay').on('click', function() {
                jQuery('#dialog-delete-cgroup').dialog('close');
            })
      },
      buttons: {
        Ok: function() {
          var cgroup = $('#delete-cgroup-name').html();

          $.ajax({
            type: "DELETE",
            url: 'http://localhost:8080/api/consumergroups',
            data: '{"groups": "' + cgroup + '"}',
            dataType: "json",
            statusCode: {
              200: handleCgroupDeleted,
              404: handle404,
              500: handle500
            }
          });

          $( this ).dialog( "close" );
        },
        Cancel: function() {
          $( this ).dialog( "close" );
        }
      },
      show: {
        effect: "bounce",
        duration: 1000
      },
      hide: {
        effect: "fade",
        duration: 1000
      }
});

$('#new-topic').click( function(e) {
  e.preventDefault();
  $('#dialog-new-topic').dialog("open");
  //$('#new-topic-def').html("Ciao mondo");
  return false;
});

function deleteTopic(topicName) {
  $('#dialog-delete-topic').dialog("open");
  $('#delete-topic-name').html(topicName);
  return false;
}

function deleteCgroup(cgroup) {
  $('#dialog-delete-cgroup').dialog("open");
  $('#delete-cgroup-name').html(cgroup);
  return false;
}

$.ajax({
  url: 'http://localhost:8080/api/controller',
  success: function(data){
    var row = "";
      $.each(data, function (index, value) {
        //console.log(value);
        row += "<tr><td>" + value.id + "</td><td>" + value.host + "</td><td>" + value.port + "</td><td>" + value.hasRack + "</td><td>" + value.rack + "</td></tr>";});

      $("#controller-table tbody").append(row);
  }
});

$.ajax({
  url: 'http://localhost:8080/api/broker',
  success: function(data){
    var row = "";
      $.each(data, function (index, value) {
        //console.log(value);
        row += "<tr><td>" + value.id + "</td><td>" + value.host + "</td><td>" + value.port + "</td></tr>";});

      $("#brokers-table tbody").append(row);

  }
});

$.ajax({
  url: 'http://localhost:8080/api/topics',
  success: function(data){
    var row = "";
      $.each(data, function (index, value) {
        //console.log(value);
        row += "<tr><td>" + value.name + "</td><td><a href='#' onclick='deleteTopic(\"" + value.name + "\");'>delete</a></td></tr>";});

      $("#topics-table tbody").append(row);

  }
});

$.ajax({
  url: 'http://localhost:8080/api/consumergroups',
  success: function(data){
    var row = "";
    $.each(data, function (index, value) {
      //console.log(value);
      row += "<tr><td>" + value.groupId + "</td><td>" + value.simpleConsumerGroup + "</td><td><a href='#' onclick='deleteCgroup(\"" + value.groupId + "\");'>delete</a></td></tr>";});

    $("#cgroups-table tbody").append(row);

  }
});
</script>


</body>
</html>
